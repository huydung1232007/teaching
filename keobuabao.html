
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>Tr√≤ ch∆°i d√¢n gian </title>
    <link href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;600;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Palette Business White */
            --bg-color: #f3f6f8;
            --card-bg: #ffffff;
            --text-main: #1c2b39;
            --text-sub: #64748b;
            
            --gold: #c5a059;
            --gold-light: #e6dace;
            
            --p1-color: #1e3a8a; /* Deep Navy */
            --p2-color: #991b1b; /* Deep Red */
            
            --shadow-card: 0 20px 40px -10px rgba(0,0,0,0.08);
            --border-light: 1px solid #e2e8f0;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background-color: var(--bg-color);
            background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%239C92AC' fill-opacity='0.03'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
            height: 100vh; margin: 0; overflow: hidden;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            color: var(--text-main); user-select: none;
        }

        .back-btn {
            position: absolute; top: 30px; left: 30px;
            padding: 10px 24px; font-size: 14px;
            background: white; border: 1px solid #cbd5e1;
            text-decoration: none; border-radius: 6px;
            font-weight: 600; color: var(--text-sub);
            transition: 0.3s; z-index: 100;
        }
        .back-btn:hover { border-color: var(--gold); color: var(--gold); }

        /* --- HEADER --- */
        .header-section { 
            text-align: center; margin-bottom: 30px; position: relative; width: 100%;
            display: flex; flex-direction: column; align-items: center;
        }
        
        .main-title {
            font-family: 'Playfair Display', serif; font-size: 48px; margin: 0; 
            color: var(--text-main); letter-spacing: 1px; line-height: 1.2;
        }
        
        .sub-title {
            font-size: 12px; font-weight: 600; letter-spacing: 3px; 
            color: var(--gold); text-transform: uppercase; margin-top: 5px;
        }

        /* B·∫¢NG T·ªà S·ªê */
        .score-board-wrapper {
            margin-top: 25px; position: relative;
            display: flex; align-items: center; justify-content: center;
            width: 200px; 
        }
        .score-line {
            position: absolute; top: 50%; left: 0; width: 100%; height: 2px;
            background: #e2e8f0; z-index: 0; transform: translateY(-50%);
        }
        
        .score-dots {
            display: flex; justify-content: space-between; width: 100%; z-index: 1;
        }

        .dot {
            width: 16px; height: 16px; border-radius: 50%;
            background: white; border: 2px solid #cbd5e1;
            transition: 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .dot.win-blue {
            background: var(--p1-color); border-color: var(--p1-color);
            transform: scale(1.5); box-shadow: 0 0 0 4px rgba(30, 58, 138, 0.1);
        }
        .dot.win-red {
            background: var(--p2-color); border-color: var(--p2-color);
            transform: scale(1.5); box-shadow: 0 0 0 4px rgba(153, 27, 27, 0.1);
        }

        /* --- ARENA --- */
        .arena-container {
            display: flex; justify-content: center; align-items: center; gap: 40px;
            width: 90%; max-width: 1000px;
        }

        .player-card {
            background: var(--card-bg); width: 320px; padding: 30px 20px;
            border-radius: 20px; box-shadow: var(--shadow-card);
            border: var(--border-light); display: flex; flex-direction: column; align-items: center;
            transition: 0.3s; position: relative; overflow: hidden;
        }
        
        .player-card::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 6px; }
        .player-card.p1::before { background: var(--p1-color); }
        .player-card.p2::before { background: var(--p2-color); }

        .name-slot-wrapper {
            width: 100%; height: 80px; background: #f8fafc; border-radius: 12px;
            border: 1px solid #e2e8f0; overflow: hidden; position: relative; margin-bottom: 20px;
        }
        .name-strip { width: 100%; transform: translateY(0); }
        .name-item {
            height: 80px; display: flex; align-items: center; justify-content: center;
            font-family: 'Playfair Display', serif; font-size: 24px; font-weight: 700;
            color: var(--text-main); text-transform: capitalize;
        }

        .select-btn {
            background: transparent; color: var(--text-sub); border: 1px solid #cbd5e1;
            padding: 8px 24px; border-radius: 30px; font-size: 13px; font-weight: 700; 
            text-transform: uppercase; letter-spacing: 1px; cursor: pointer; transition: 0.2s;
        }
        .select-btn:hover:not(:disabled) { border-color: var(--text-main); color: var(--text-main); }
        .select-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .hand-wrapper {
            height: 160px; display: flex; align-items: center; justify-content: center;
            font-size: 110px; margin-top: 20px; margin-bottom: 10px;
            filter: drop-shadow(0px 4px 0px #b89628) drop-shadow(0px 8px 15px rgba(184, 150, 40, 0.4)) brightness(1.05);
            transition: all 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);
        }
        .hand-wrapper:hover { transform: translateY(-5px) scale(1.05); }
        #hand2 { transform: scaleX(-1); }

        .center-action { display: flex; flex-direction: column; align-items: center; justify-content: center; width: 120px; }
        .vs-text {
            font-family: 'Playfair Display', serif; font-size: 40px; font-style: italic; font-weight: 900;
            color: #cbd5e1; margin-bottom: 20px;
        }
        
        .start-btn {
            background: var(--text-main); color: white; border: none;
            width: 70px; height: 70px; border-radius: 50%;
            font-size: 12px; font-weight: 800; text-transform: uppercase;
            cursor: pointer; box-shadow: 0 10px 20px rgba(0,0,0,0.2);
            display: none; transition: 0.3s; animation: pulse 2s infinite;
        }
        .start-btn:hover { transform: scale(1.1); background: var(--gold); }
        @keyframes pulse { 0% {box-shadow: 0 0 0 0 rgba(28, 43, 57, 0.2);} 70% {box-shadow: 0 0 0 10px rgba(28, 43, 57, 0);} 100% {box-shadow: 0 0 0 0 rgba(28, 43, 57, 0);} }

        .status-bar {
            position: absolute; bottom: 40px; background: white; padding: 10px 30px; border-radius: 50px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.05); border: 1px solid #f1f5f9;
            color: var(--text-sub); font-size: 14px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px;
        }

        /* --- POPUP WINNER --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(5px);
            z-index: 1000; display: none; align-items: center; justify-content: center;
            animation: fadeIn 0.4s ease;
        }
        @keyframes fadeIn { from{opacity:0} to{opacity:1} }
        
        .winner-modal {
            background: white; width: 450px; padding: 50px 30px;
            border-radius: 30px; text-align: center;
            box-shadow: 0 30px 60px -15px rgba(0,0,0,0.15); border: 1px solid #f1f5f9;
        }
        .modal-icon { font-size: 60px; margin-bottom: 20px; display: block; filter: drop-shadow(0 5px 10px rgba(197, 160, 89, 0.3)); }
        .modal-label { font-size: 12px; font-weight: 700; color: var(--gold); letter-spacing: 4px; text-transform: uppercase; }
        .modal-name { 
            font-family: 'Playfair Display', serif; font-size: 40px; font-weight: 900; 
            margin: 15px 0 30px 0; color: var(--text-main); line-height: 1.1;
        }
        .modal-btn {
            background: var(--text-main); color: white; border: none;
            padding: 15px 40px; border-radius: 50px; font-size: 14px; font-weight: 700;
            cursor: pointer; transition: 0.2s; letter-spacing: 1px;
        }
        .modal-btn:hover { background: var(--gold); transform: translateY(-2px); }

        .shaking { animation: shake 0.4s infinite cubic-bezier(.36,.07,.19,.97) both; }
        @keyframes shake { 0% { transform: rotate(0deg) translateY(0); } 25% { transform: rotate(-10deg) translateY(-10px); } 50% { transform: rotate(0deg) translateY(0); } 75% { transform: rotate(10deg) translateY(-10px); } 100% { transform: rotate(0deg) translateY(0); } }

        #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9999; }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">Tho√°t</a>
    <canvas id="confettiCanvas"></canvas>

    <div class="overlay" id="overlay">
        <div class="winner-modal">
            <span class="modal-icon">üèÜ</span>
            <div class="modal-label">Nh√† V√¥ ƒê·ªãch</div>
            <div class="modal-name" id="winnerName">Nguyen Van A</div>
            <button class="modal-btn" onclick="closePopup()">TI·∫æP T·ª§C</button>
        </div>
    </div>

    <div class="header-section">
        <h1 class="main-title">O·∫≥n T√π T√¨ </h1>
        <div class="sub-title">Best of 3 Series</div>
        
        <div class="score-board-wrapper">
            <div class="score-line"></div>
            <div class="score-dots">
                <div class="dot" id="dot1"></div>
                <div class="dot" id="dot2"></div>
                <div class="dot" id="dot3"></div>
            </div>
        </div>
    </div>

    <div class="arena-container">
        <div class="player-card p1">
            <div class="name-slot-wrapper">
                <div class="name-strip" id="strip1">
                    <div class="name-item" style="color:#94a3b8">Player 01</div>
                </div>
            </div>
            <button class="select-btn" id="btn1" onclick="spinPlayer(1)">Ch·ªçn Ng∆∞·ªùi Ch∆°i</button>
            <div class="hand-wrapper">
                <div id="hand1">‚úä</div>
            </div>
        </div>

        <div class="center-action">
            <div class="vs-text">vs</div>
            <button class="start-btn" id="startBtn" onclick="startMatch()">PLAY</button>
        </div>

        <div class="player-card p2">
            <div class="name-slot-wrapper">
                <div class="name-strip" id="strip2">
                    <div class="name-item" style="color:#94a3b8">Player 02</div>
                </div>
            </div>
            <button class="select-btn" id="btn2" onclick="spinPlayer(2)">Ch·ªçn Ng∆∞·ªùi Ch∆°i</button>
            <div class="hand-wrapper">
                <div id="hand2">‚úä</div>
            </div>
        </div>
    </div>

    <div class="status-bar" id="statusText">Vui l√≤ng ch·ªçn 2 ƒë·∫•u th·ªß</div>

    <script>
        let fullList = [];
        let remaining = []; // Danh s√°ch ng∆∞·ªùi ch∆∞a tr√∫ng
        const ICONS = { rock: '‚úä', paper: '‚úã', scissors: '‚úåÔ∏è' };
        let player1 = "", player2 = "";
        let score1 = 0, score2 = 0;
        let currentRound = 1;
        let isSpinning = false;

        function initData() {
            const f = localStorage.getItem('classStudents');
            fullList = f ? f.split('\n').filter(n => n.trim() !== '') : [];
            
            const r = localStorage.getItem('remainingStudents');
            if (r) {
                remaining = JSON.parse(r);
            } else {
                remaining = [...fullList];
                localStorage.setItem('remainingStudents', JSON.stringify(remaining));
            }
        }
        initData();

        function spinPlayer(id) {
            if(isSpinning) return;
            
            // C·∫ßn √≠t nh·∫•t 2 ng∆∞·ªùi c√≤n l·∫°i (n·∫øu P1 ch∆∞a ch·ªçn) ho·∫∑c 1 ng∆∞·ªùi (n·∫øu P1 ƒë√£ ch·ªçn)
            let needed = 1;
            if ((id === 1 && !player2) || (id === 2 && !player1)) needed = 2; 
            
            if (remaining.length < needed) {
                if (confirm("Danh s√°ch c√≤n l·∫°i kh√¥ng ƒë·ªß ng∆∞·ªùi ch∆°i! B·∫°n c√≥ mu·ªën Reset danh s√°ch kh√¥ng?")) {
                    remaining = [...fullList];
                    localStorage.setItem('remainingStudents', JSON.stringify(remaining));
                    alert("ƒê√£ reset danh s√°ch! Vui l√≤ng ch·ªçn l·∫°i.");
                }
                return;
            }

            const btn = document.getElementById(`btn${id}`);
            const strip = document.getElementById(`strip${id}`);
            isSpinning = true;
            btn.disabled = true;

            let html = "";
            for(let i=0; i<40; i++) {
                let name = fullList[Math.floor(Math.random() * fullList.length)];
                html += `<div class="name-item">${name}</div>`;
            }
            
            // CH·ªåN NG∆Ø·ªúI T·ª™ DANH S√ÅCH "REMAINING"
            let finalName = "";
            let safetyLoop = 0;
            do {
                finalName = remaining[Math.floor(Math.random() * remaining.length)];
                safetyLoop++;
            } while (
                ((id === 1 && finalName === player2) || (id === 2 && finalName === player1)) 
                && safetyLoop < 50
            );
            
            let color = id === 1 ? 'var(--p1-color)' : 'var(--p2-color)';
            html += `<div class="name-item" style="color:${color}; font-weight:700;">${finalName}</div>`;
            strip.innerHTML = html;

            if(id === 1) player1 = finalName; else player2 = finalName;

            strip.style.transition = 'none'; strip.style.transform = 'translateY(0)'; strip.offsetHeight; 
            const totalHeight = 40 * 80; 

            setTimeout(() => {
                strip.style.transition = `transform 3000ms cubic-bezier(0.1, 0.7, 0.1, 1)`;
                strip.style.transform = `translateY(-${totalHeight}px)`;
            }, 50);

            setTimeout(() => { isSpinning = false; checkReady(); }, 3200);
        }

        function checkReady() {
            if (player1 && player2) {
                updateStatus("S·∫µn s√†ng! Nh·∫•n Play ƒë·ªÉ b·∫Øt ƒë·∫ßu", "#1c2b39");
                document.getElementById('startBtn').style.display = "block";
            }
        }

        function updateStatus(msg, color) {
            const st = document.getElementById('statusText');
            st.innerText = msg;
            st.style.color = color || "var(--text-sub)";
        }

        function startMatch() {
            score1 = 0; score2 = 0; currentRound = 1;
            resetDots();
            document.getElementById('startBtn').style.display = "none";
            document.getElementById('btn1').disabled = true;
            document.getElementById('btn2').disabled = true;
            fightRound();
        }

        function resetDots() {
            for(let i=1; i<=3; i++) {
                document.getElementById(`dot${i}`).className = "dot";
            }
        }

        function fightRound() {
            const h1 = document.getElementById('hand1');
            const h2 = document.getElementById('hand2');

            h1.innerText = ICONS.rock; h1.style.transform = "rotate(0deg)";
            h2.innerText = ICONS.rock; h2.style.transform = "scaleX(-1) rotate(0deg)";
            h1.classList.add('shaking'); h2.classList.add('shaking');
            
            updateStatus(`Hi·ªáp ${currentRound} ƒëang di·ªÖn ra...`, "#1c2b39");

            setTimeout(() => {
                h1.classList.remove('shaking'); h2.classList.remove('shaking');
                const keys = ['rock', 'paper', 'scissors'];
                const res1 = keys[Math.floor(Math.random() * keys.length)];
                const res2 = keys[Math.floor(Math.random() * keys.length)];
                h1.innerText = ICONS[res1]; h2.innerText = ICONS[res2];

                const result = checkRoundWinner(res1, res2);

                if (result === 0) {
                    updateStatus("H√≤a! ƒê·∫•u l·∫°i...", "#64748b");
                    setTimeout(fightRound, 1500); 
                } else {
                    const dot = document.getElementById(`dot${currentRound}`);
                    if (result === 1) {
                        score1++; 
                        dot.classList.add("win-blue");
                        updateStatus(`${player1} Th·∫Øng Hi·ªáp ${currentRound}`, "var(--p1-color)");
                    } else {
                        score2++; 
                        dot.classList.add("win-red");
                        updateStatus(`${player2} Th·∫Øng Hi·ªáp ${currentRound}`, "var(--p2-color)");
                    }
                    currentRound++;
                    if (score1 === 2 || score2 === 2) {
                        setTimeout(() => endMatch(score1 === 2 ? 1 : 2), 1500);
                    } else {
                        setTimeout(fightRound, 2500); 
                    }
                }
            }, 2000);
        }

        function checkRoundWinner(c1, c2) {
            if (c1 === c2) return 0;
            if ((c1 === 'rock' && c2 === 'scissors') || (c1 === 'paper' && c2 === 'rock') || (c1 === 'scissors' && c2 === 'paper')) return 1;
            return 2;
        }

        function endMatch(winnerId) {
            const winnerName = winnerId === 1 ? player1 : player2;
            const winnerColor = winnerId === 1 ? 'var(--p1-color)' : 'var(--p2-color)';
            updateStatus("Tr·∫≠n ƒë·∫•u k·∫øt th√∫c", winnerColor);
            
            // --- LOGIC X√ìA C·∫¢ 2 NG∆Ø·ªúI CH∆†I KH·ªéI DANH S√ÅCH ---
            // D√π th·∫Øng hay thua th√¨ ƒë√£ ch∆°i r·ªìi -> X√≥a kh·ªèi remaining
            const idx1 = remaining.indexOf(player1);
            if (idx1 > -1) remaining.splice(idx1, 1);

            const idx2 = remaining.indexOf(player2);
            if (idx2 > -1) remaining.splice(idx2, 1);

            // L∆∞u l·∫°i danh s√°ch m·ªõi
            localStorage.setItem('remainingStudents', JSON.stringify(remaining));
            // --------------------------------------------------

            fireConfetti('#c5a059');
            setTimeout(() => {
                document.getElementById('winnerName').innerText = winnerName;
                document.getElementById('winnerName').style.color = winnerColor;
                document.getElementById('overlay').style.display = 'flex';
            }, 800);
        }

        function closePopup() {
            document.getElementById('overlay').style.display = 'none';
            player1 = ""; player2 = "";
            
            // Reset Name Strips
            document.getElementById('strip1').innerHTML = '<div class="name-item" style="color:#94a3b8">Player 01</div>';
            document.getElementById('strip2').innerHTML = '<div class="name-item" style="color:#94a3b8">Player 02</div>';
            document.getElementById('strip1').style.transform = 'translateY(0)';
            document.getElementById('strip2').style.transform = 'translateY(0)';
            
            document.getElementById('btn1').disabled = false; 
            document.getElementById('btn2').disabled = false;
            updateStatus("Vui l√≤ng ch·ªçn 2 ƒë·∫•u th·ªß", "#64748b");
            resetDots();
        }

        const canvas=document.getElementById('confettiCanvas'), cx=canvas.getContext('2d'); let p=[];
        function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;} window.addEventListener('resize',resizeCanvas); resizeCanvas();
        function fireConfetti(color){ p=[]; for(let i=0;i<150;i++) p.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*20,vy:(Math.random()-0.5)*20-5,c:color || '#d4af37',s:Math.random()*10+5}); animate(); }
        function animate(){ if(p.length===0)return; cx.clearRect(0,0,canvas.width,canvas.height); p.forEach((pt,i)=>{pt.x+=pt.vx;pt.y+=pt.vy;pt.vy+=0.2;pt.vx*=0.96;pt.vy*=0.96;cx.fillStyle=pt.c;cx.fillRect(pt.x,pt.y,pt.s,pt.s);if(pt.y>canvas.height)p.splice(i,1)}); requestAnimationFrame(animate); }
    </script>
</body>
</html>
