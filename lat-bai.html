<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>L·∫≠t B√†i Doanh Nh√¢n</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700;900&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Nunito', sans-serif;
            background-color: #0f172a;
            min-height: 100vh; overflow-x: hidden; text-align: center; color: white;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
        }
        .back-btn {
            position: absolute; top: 20px; left: 20px;
            padding: 10px 25px; background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2);
            text-decoration: none; border-radius: 30px; font-weight: bold; color: #f1c40f;
            backdrop-filter: blur(5px); z-index: 100; transition: 0.3s;
        }
        .back-btn:hover { background: rgba(255,255,255,0.2); }

        h1 { font-family: 'Playfair Display', serif; color: #f1c40f; margin-bottom: 5px; font-size: 45px; letter-spacing: 2px; }
        
        .btn-action {
            background: linear-gradient(90deg, #f1c40f, #d4ac0d);
            color: #1e293b; border: none; padding: 15px 60px;
            border-radius: 50px; font-size: 18px; font-weight: 900; cursor: pointer;
            transition: 0.3s; box-shadow: 0 0 20px rgba(241, 196, 15, 0.3); margin-top: 50px;
        }
        .btn-action:hover { transform: scale(1.05); box-shadow: 0 0 40px rgba(241, 196, 15, 0.5); }

        /* --- CARD TABLE --- */
        .card-table { 
            position: relative; width: 100%; max-width: 1000px; min-width: 800px; 
            height: 250px; margin-top: 50px; perspective: 1000px;
            overflow-x: auto; overflow-y: visible;
        }

        /* KHUNG TH·∫∫ B√ÄI (Ch·ªâ lo v·ªã tr√≠, kh√¥ng lo xoay) */
        .card { 
            position: absolute; width: 130px; height: 200px;
            cursor: pointer; transform-style: preserve-3d; 
            transition: transform 0.6s cubic-bezier(0.4, 0.0, 0.2, 1), left 0.5s, opacity 0.5s, filter 0.5s;
            left: 50%; top: 0; 
            transform: translateX(-50%); /* CƒÉn gi·ªØa */
            z-index: 10; 
        }
        
        .card.disabled { cursor: not-allowed; pointer-events: none; }
        
        /* KHI L·∫¨T: CH·ªà PH√ìNG TO KHUNG, KH√îNG XOAY KHUNG N·ªÆA (S·ª≠a l·ªói ·ªü ƒë√¢y) */
        .card.is-flipped { 
            transform: translateX(-50%) scale(1.1); /* Gi·ªØ v·ªã tr√≠, ph√≥ng to nh·∫π */
            z-index: 100; 
        }
        
        .card.dimmed { opacity: 0.2; filter: grayscale(100%); transform: translateX(-50%) scale(0.9); z-index: 1; }

        /* RU·ªòT TH·∫∫ B√ÄI (Ch·ªãu tr√°ch nhi·ªám xoay) */
        .card-inner { 
            position: relative; width: 100%; height: 100%; text-align: center; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.8); border-radius: 15px; 
            pointer-events: none;
            transition: transform 0.8s; /* T·ªëc ƒë·ªô xoay */
            transform-style: preserve-3d;
        } 

        /* XOAY RU·ªòT 180 ƒê·ªò KHI L·∫¨T */
        .card.is-flipped .card-inner { transform: rotateY(180deg); }

        .card-face { 
            position: absolute; width: 100%; height: 100%; 
            backface-visibility: hidden; /* Quan tr·ªçng: ·∫®n m·∫∑t sau */
            border-radius: 15px; display: flex; align-items: center; justify-content: center; 
            flex-direction: column; border: 1px solid #334155; 
        }
        
        /* M·∫∑t tr∆∞·ªõc (√öp - Pattern) */
        .card-front { 
            background: #1e293b;
            background-image: repeating-linear-gradient(
                45deg,
                rgba(255, 255, 255, 0.03),
                rgba(255, 255, 255, 0.03) 10px,
                transparent 10px,
                transparent 20px
            );
            border: 2px solid #334155;
            transform: rotateY(0deg); /* M·∫∑c ƒë·ªãnh 0 ƒë·ªô */
        }
        
        .card-logo { font-size: 40px; color: #64748b; transition: 0.3s; }
        .card:not(.is-flipped):not(.disabled):hover .card-front { border-color: #f1c40f; }
        .card:not(.is-flipped):not(.disabled):hover .card-logo { color: #f1c40f; text-shadow: 0 0 10px #f1c40f; }

        /* M·∫∑t sau (Ng·ª≠a - T√™n HS) */
        .card-back { 
            background: #fff; color: #1e293b; 
            border: 4px solid #f1c40f;
            transform: rotateY(180deg); /* Xoay s·∫µn 180 ƒë·ªô */
        }
        
        .card-name-sm { 
            font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 900; 
            padding: 10px; word-wrap: break-word; line-height: 1.2; color: #1e293b;
        }

        /* --- POPUP SANG TR·ªåNG --- */
        .fixed-overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.9); z-index: 50000; display: none; backdrop-filter: blur(5px); animation: fadeIn 0.3s; }
        .fixed-overlay.active { display: block; }
        @keyframes fadeIn { from {opacity: 0;} to {opacity: 1;} }
        
        .winner-popup-container { 
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.8); 
            width: 360px; z-index: 50001; 
            transition: 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); 
            pointer-events: none; opacity: 0;
        }
        .winner-popup-container.active { transform: translate(-50%, -50%) scale(1); opacity: 1; pointer-events: auto; }
        
        .popup-card { 
            width: 100%; padding: 50px 20px; border-radius: 20px; 
            background: #f8fafc; border: 6px solid #f1c40f; 
            box-shadow: 0 0 100px rgba(241, 196, 15, 0.5); 
            display: flex; flex-direction: column; align-items: center; justify-content: center; 
            position: relative;
        }
        
        .popup-crown { font-size: 80px; margin-bottom: 20px; text-shadow: 0 5px 15px rgba(0,0,0,0.1); opacity: 0.2; }
        .popup-label { font-size: 12px; letter-spacing: 4px; color: #64748b; font-weight: bold; text-transform: uppercase; margin-top: 10px; }
        .popup-name { 
            font-family: 'Playfair Display', serif; font-size: 42px; font-weight: 900;
            color: #1e293b; margin-bottom: 30px; line-height: 1.1; 
        }
        .popup-close-btn { 
            background: #1e293b; color: white; border: none; padding: 12px 40px; 
            border-radius: 30px; cursor: pointer; font-size: 14px; font-weight: bold; transition: 0.3s;
        }
        .popup-close-btn:hover { background: #334155; transform: translateY(-2px); }
        
        #confettiCanvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 99999; }
    </style>
</head>
<body>
    <a href="index.html" class="back-btn">‚¨Ö Trang Ch·ªß</a>
    <canvas id="confettiCanvas"></canvas>
    
    <div class="fixed-overlay" id="fixedOverlay" onclick="closePopup()"></div>
    <div class="winner-popup-container" id="winnerPopup">
        <div class="popup-card">
            <div class="popup-crown">üëë</div>
            <div class="popup-name" id="popupName">Nguyen Van A</div>
            <div class="popup-label">THE WINNER</div>
            <button class="popup-close-btn" onclick="closePopup()">ƒê√≥ng</button>
        </div>
    </div>

    <div>
        <h1>SELECT YOUR CARD</h1>
        <p id="cardStatus" style="color: #94a3b8; font-style: italic;">M·ªùi ch·ªçn 1 l√° b√†i b·∫•t k·ª≥</p>
        <div class="card-table" id="cardArea"></div>
        <button class="btn-action" onclick="startCardGame()">X√†o B√†i</button>
    </div>

    <script>
        let fullList=[], remaining=[];
        let isGameActive = false;

        function initData(){
            const f=localStorage.getItem('classStudents');fullList=f?f.split('\n').filter(n=>n.trim()!==''):[];
            const r=localStorage.getItem('remainingStudents');remaining=r?JSON.parse(r):(fullList.length>0?[...fullList]:[]);
            if(!r && fullList.length>0) localStorage.setItem('remainingStudents',JSON.stringify(remaining));
        }
        initData();

        function getUniqueCandidates(count){
            initData();
            if(remaining.length===0){
                if(fullList.length===0){ alert("Ch∆∞a c√≥ danh s√°ch!"); return []; }
                if(confirm("ƒê√£ g·ªçi h·∫øt danh s√°ch! Reset l·∫°i?")){ remaining=[...fullList]; localStorage.setItem('remainingStudents',JSON.stringify(remaining)); } else return [];
            }
            let res=[], set=new Set(), poolRem=[...remaining];
            while(res.length<count && poolRem.length>0){ let i=Math.floor(Math.random()*poolRem.length); res.push(poolRem[i]); set.add(poolRem[i]); poolRem.splice(i,1); }
            if(res.length<count && fullList.length>0){ let poolBack=fullList.filter(n=>!set.has(n)); while(res.length<count && poolBack.length>0){ let i=Math.floor(Math.random()*poolBack.length); res.push(poolBack[i]); set.add(poolBack[i]); poolBack.splice(i,1); }}
            if(res.length<count && fullList.length>0){ while(res.length<count){ res.push(fullList[Math.floor(Math.random()*fullList.length)]); }}
            return res.sort(()=>0.5-Math.random());
        }

        function removeStudent(n){ initData(); const i=remaining.indexOf(n); if(i>-1){ remaining.splice(i,1); localStorage.setItem('remainingStudents',JSON.stringify(remaining)); }}

        const CARD_POS=[15, 32.5, 50, 67.5, 85]; 
        let cardElements=[];

        function startCardGame(){
            if(fullList.length<1){alert("Vui l√≤ng nh·∫≠p danh s√°ch ·ªü Trang Ch·ªß!");return;}
            
            closePopup(); 
            isGameActive = false; 
            
            const cands=getUniqueCandidates(5); if(cands.length===0) return;
            
            const area = document.getElementById('cardArea'); 
            area.innerHTML = ''; 
            cardElements=[];
            document.getElementById('cardStatus').innerText="ƒêang tr√°o b√†i...";
            
            cands.forEach((n,i)=>{
                const card=document.createElement('div'); card.className='card disabled'; 
                card.style.left="50%";
                
                card.innerHTML=`
                    <div class="card-inner">
                        <div class="card-face card-front">
                            <div class="card-logo">‚ú¶</div>
                        </div>
                        <div class="card-face card-back">
                            <div style="font-size:30px;color:#f1c40f">üëë</div>
                            <div class="card-name-sm">${n}</div>
                        </div>
                    </div>`;
                
                card.onclick=(e)=>{
                    e.stopPropagation();
                    if(!isGameActive || card.classList.contains('disabled')) return;
                    
                    isGameActive = false;
                    document.getElementById('cardStatus').innerText="ƒê√£ ch·ªçn! B·∫•m 'X√†o B√†i' ƒë·ªÉ ch∆°i v√°n m·ªõi.";

                    card.classList.add('is-flipped'); 
                    
                    cardElements.forEach(c => {
                        if(c !== card) {
                            c.classList.add('dimmed');
                            c.classList.add('disabled');
                        }
                    });

                    removeStudent(n); 
                    
                    setTimeout(()=>showPopup(n), 600);
                };
                
                area.appendChild(card); cardElements.push(card);
            });

            setTimeout(()=>{
                cardElements.forEach((c,i)=>c.style.left=CARD_POS[i]+"%");
                setTimeout(()=>{ 
                    shuffle(cardElements,5); 
                },800);
            },100);
        }
        
        function shuffle(cards,t){
            if(t<=0){ 
                document.getElementById('cardStatus').innerText="M·ªùi ch·ªçn 1 l√° b√†i b·∫•t k·ª≥"; 
                cards.forEach(c=>c.classList.remove('disabled')); 
                isGameActive = true;
                return; 
            }
            let i1=Math.floor(Math.random()*5),i2=Math.floor(Math.random()*5); while(i1===i2)i2=Math.floor(Math.random()*5);
            let p1=cards[i1].style.left, p2=cards[i2].style.left; cards[i1].style.left=p2; cards[i2].style.left=p1;
            cards[i1].style.zIndex=100; setTimeout(()=>cards[i1].style.zIndex=10,300);
            setTimeout(()=>shuffle(cards,t-1),500);
        }

        function showPopup(n){ 
            document.getElementById('popupName').innerText=n; 
            document.getElementById('fixedOverlay').classList.add('active'); 
            document.getElementById('winnerPopup').classList.add('active'); 
            fireConfetti(); 
        }

        function closePopup(){ 
            document.getElementById('fixedOverlay').classList.remove('active'); 
            document.getElementById('winnerPopup').classList.remove('active'); 
        }

        const canvas=document.getElementById('confettiCanvas'), ctx=canvas.getContext('2d'); let p=[];
        function resizeCanvas(){canvas.width=window.innerWidth;canvas.height=window.innerHeight;} window.addEventListener('resize',resizeCanvas); resizeCanvas();
        function fireConfetti(){ p=[]; for(let i=0;i<150;i++) p.push({x:canvas.width/2,y:canvas.height/2,vx:(Math.random()-0.5)*15,vy:(Math.random()-0.5)*15-5,c:'#f1c40f',s:Math.random()*10+5}); animate(); }
        function animate(){ if(p.length===0)return; ctx.clearRect(0,0,canvas.width,canvas.height); p.forEach((pt,i)=>{pt.x+=pt.vx;pt.y+=pt.vy;pt.vy+=0.2;pt.vx*=0.96;pt.vy*=0.96;ctx.fillStyle=pt.c;ctx.fillRect(pt.x,pt.y,pt.s,pt.s);if(pt.y>canvas.height)p.splice(i,1)}); requestAnimationFrame(animate); }
    </script>
</body>
</html>